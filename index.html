<!DOCTYPE html>
<html>
<head>
  <title>FEELCYCLE予約チェック</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- flatpickrカレンダー用 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>FEELCYCLE レッスン登録</h2>
  <form id="reserveForm">
    <label>スタジオ:<br>
      <select id="studio" required>
        <option value="">選択してください</option>
        <option value="銀座">銀座</option>
        <option value="銀座京橋">銀座京橋</option>
        <option value="汐留">汐留</option>
        <option value="吉祥寺">吉祥寺</option>
        <option value="池袋">池袋</option>
        <option value="自由が丘">自由が丘</option>
        <option value="渋谷">渋谷</option>
        <option value="五反田">五反田</option>
        <option value="新宿">新宿</option>
        <option value="中目黒">中目黒</option>
        <option value="上野">上野</option>
        <option value="川崎">川崎</option>
        <option value="横浜">横浜</option>
        <option value="上大岡">上大岡</option>
        <option value="横須賀中央">横須賀中央</option>
        <option value="海浜幕張">海浜幕張</option>
        <option value="船橋">船橋</option>
        <option value="町田">町田</option>
        <option value="立川">立川</option>
        <option value="多摩センター">多摩センター</option>
        <option value="武蔵小杉">武蔵小杉</option>
        <option value="大宮">大宮</option>
        <option value="越谷">越谷</option>
        <option value="柏">柏</option>
      </select>
    </label>
    <br><br>
    <label>日付:<br>
      <input type="text" id="datePicker" placeholder="日付を選択" required>
    </label>
    <br><br>
    <label>時間:<br>
      <select id="timePicker" required>
      <option value="">選択してください</option>
      <option value="07:00">07:00</option>
      <option value="07:15">07:15</option>
      <option value="07:30">07:30</option>
      <option value="07:45">07:45</option>
      <option value="08:00">08:00</option>
      <option value="08:15">08:15</option>
      <option value="08:30">08:30</option>
      <option value="08:45">08:45</option>
      <option value="09:00">09:00</option>
      <option value="09:15">09:15</option>
      <option value="09:30">09:30</option>
      <option value="09:45">09:45</option>
      <option value="10:00">10:00</option>
      <option value="10:15">10:15</option>
      <option value="10:30">10:30</option>
      <option value="10:45">10:45</option>
      <option value="11:00">11:00</option>
      <option value="11:15">11:15</option>
      <option value="11:30">11:30</option>
      <option value="11:45">11:45</option>
      <option value="12:00">12:00</option>
      <option value="12:15">12:15</option>
      <option value="12:30">12:30</option>
      <option value="12:45">12:45</option>
      <option value="13:00">13:00</option>
      <option value="13:15">13:15</option>
      <option value="13:30">13:30</option>
      <option value="13:45">13:45</option>
      <option value="14:00">14:00</option>
      <option value="14:15">14:15</option>
      <option value="14:30">14:30</option>
      <option value="14:45">14:45</option>
      <option value="15:00">15:00</option>
      <option value="15:15">15:15</option>
      <option value="15:30">15:30</option>
      <option value="15:45">15:45</option>
      <option value="16:00">16:00</option>
      <option value="16:15">16:15</option>
      <option value="16:30">16:30</option>
      <option value="16:45">16:45</option>
      <option value="17:00">17:00</option>
      <option value="17:15">17:15</option>
      <option value="17:30">17:30</option>
      <option value="17:45">17:45</option>
      <option value="18:00">18:00</option>
      <option value="18:15">18:15</option>
      <option value="18:30">18:30</option>
      <option value="18:45">18:45</option>
      <option value="19:00">19:00</option>
      <option value="19:15">19:15</option>
      <option value="19:30">19:30</option>
      <option value="19:45">19:45</option>
      <option value="20:00">20:00</option>
      <option value="20:15">20:15</option>
      <option value="20:30">20:30</option>
      <option value="20:45">20:45</option>
      <option value="21:00">21:00</option>
      <option value="21:15">21:15</option>
      <option value="21:30">21:30</option>
    </select>
  </label>
    <br><br>
    <button type="submit">登録</button>
  </form>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // flatpickrでMM/DD形式の入力にする（年をつけず）
    flatpickr("#datePicker", {
      dateFormat: "m/d",
      allowInput: true,
    });

    // LIFF初期化してuserIdを取得する
    let userId = "";
    window.onload = function () {
      liff.init({
        liffId: "2007455412-YP5jEbzK" // 例: "2007455410-5RBZMAoM"
      }).then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          liff.getProfile().then(function (profile) {
            userId = profile.userId;
          });
        }
      }).catch(function (err) {
        alert('LIFF初期化失敗: ' + err);
      });
    }

    document.getElementById('reserveForm').onsubmit = async function(e) {
      e.preventDefault();
      const studio = document.getElementById('studio').value;
      const date = document.getElementById('datePicker').value;
      const time = document.getElementById('timePicker').value;
      if (!userId) {
        alert('userId取得失敗。LINEアプリから開いてください。');
        return;
      }
      await fetch('https://script.google.com/macros/s/AKfycbw0FaYNrDXKQUTH6bvEYoAwpGdyP0b9JDVF984cjFNReWilXCMQ7dApMtiqDtxx47jBYQ/exec', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ studio, date, time, userId })
      });
      alert('送信しました！');
      // LIFF環境なら自動でウィンドウを閉じる
      if (window.liff && window.liff.closeWindow) liff.closeWindow();
    }
  </script>
</body>
</html>
